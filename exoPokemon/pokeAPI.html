<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="./ajax.js"></script>
    <style>
        #divGlobale{
            display: flex;
        }

        #divAffichage > p{
            text-transform: capitalize;
            flex: 3;
        }

        #divDetail {
            margin-left: 10%;
        }

        a{
            cursor: pointer;
        }

        .text-capitalize{
            text-transform: capitalize;
        }
    </style>
</head>
<body>

    <div id="divGlobale">
        <div id="divAffichage">
        
        </div>
    
        <div id="divDetail">
            <div id="detailsPokemon">
            
            </div>
            <img src="" alt="">
        </div>
    </div>

    <script>
        const tabPokemon = [];

        function buildList(detail) {
            const div = document.getElementById("divAffichage");
            let newP = document.createElement("p");
            let newA = document.createElement("a");
            newA.setAttribute("id", detail.url);
            newA.setAttribute("class", "linkPokemon")
            newA.innerText = detail.name;
            newP.append(newA);
            div.append(newP);
        }
        
        Ajax.get("https://pokeapi.co/api/v2/pokemon/")
        .then((data) => {
            tabPokemon.push(JSON.parse(data));

            for (let i = 0; i < tabPokemon[0].results.length; i++) {
                buildList(tabPokemon[0].results[i]);
            }

            const pokemons = document.querySelectorAll(".linkPokemon");

            for (let i = 0; i < pokemons.length; i++) {
                pokemons[i].addEventListener("click", function(event){
                    getPokemon(event.originalTarget.id).then(data => buildDetails(data))
                    // buildDetails(await getPokemon(event.originalTarget.id));
                })
            }
        })
        .catch(e => console.error(e));

        async function getPokemon(uri) {
            const data = await Ajax.get(uri);
            return JSON.parse(data);
        }

        function buildArray(array, title, fct) {
            let div = document.createElement("div");
            let h4 = document.createElement("h4");
            h4.innerText = title;

            let ul = document.createElement("ul");

            for (let item of array) {
                let li = document.createElement("li");
                li.innerText = fct(item);
                li.classList.add("text-capitalize");
                ul.append(li);
            }
            div.append(h4, ul);
            return div;
        }

        function buildDetails(pokemon) {
            const divDetails = document.querySelector("#detailsPokemon");

            // Remove all infos existing
            while (divDetails.firstChild) {
                divDetails.removeChild(divDetails.lastChild);
            }

            let h1 = document.createElement("h1");
            h1.classList.add("text-capitalize");
            h1.innerText = pokemon.name;

            // Attributes
            let divAttributes = buildArray(pokemon.abilities, "Attributes :", (item) => item.ability.name)

            // Types
            let divTypes = buildArray(pokemon.types, "Types: ", (item) => item.type.name);

            // Skills
            let divSkills = buildArray(pokemon.moves.slice(0,4), "Skills: ", (item) => item.move.name);
            
            // Image
            let img = document.querySelector("img");
            img.setAttribute("src", pokemon.sprites.front_default);

        
            divDetails.append(h1, divAttributes, divTypes, divSkills);
        }
        
    </script>
</body>
</html>